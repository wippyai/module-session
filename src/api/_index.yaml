version: "1.0"
namespace: wippy.session.api

entries:
  # Requirements
  - name: __requirement-target_api_router
    kind: ns.requirement
    meta:
      description: "Application API router ID for HTTP endpoints"
    targets:
      - entry: get_artifact
        path: ".meta.router"
      - entry: get_artifact.endpoint
        path: ".meta.router"
      - entry: get_artifact_content
        path: ".meta.router"
      - entry: get_artifact_content.endpoint
        path: ".meta.router"
      - entry: get_session
        path: ".meta.router"
      - entry: get_session.endpoint
        path: ".meta.router"
      - entry: list_sessions
        path: ".meta.router"
      - entry: list_sessions.endpoint
        path: ".meta.router"
      - entry: session_messages
        path: ".meta.router"
      - entry: session_messages.endpoint
        path: ".meta.router"

  # wippy.session.api:get_artifact
  - name: get_artifact
    kind: function.lua
    meta:
      comment: Returns metadata for an artifact by ID
      depends_on:
        - ns:app
        - ns:wippy.session.persist
    source: file://get_artifact.lua
    modules:
      - http
      - json
      - security
    imports:
      artifact_repo: wippy.session.persist:artifact_repo
      session_repo: wippy.session.persist:session_repo
    method: handler
    pool:
      size: 2
    
  # wippy.session.api:get_artifact.endpoint
  - name: get_artifact.endpoint
    kind: http.endpoint
    meta:
      comment: Endpoint that returns metadata for an artifact
      depends_on:
        - ns:app
    method: GET
    func: get_artifact
    path: /artifact/{id}
    
  # wippy.session.api:get_artifact_content
  - name: get_artifact_content
    kind: function.lua
    meta:
      comment: Returns content for an artifact by ID
      depends_on:
        - ns:app
        - ns:wippy.session.persist
    source: file://get_artifact_content.lua
    modules:
      - http
      - json
      - security
    imports:
      artifact_repo: wippy.session.persist:artifact_repo
      renderer: wippy.views:renderer
      session_repo: wippy.session.persist:session_repo
    method: handler
    pool:
      size: 2
    
  # wippy.session.api:get_artifact_content.endpoint
  - name: get_artifact_content.endpoint
    kind: http.endpoint
    meta:
      comment: Endpoint that returns content for an artifact
      depends_on:
        - ns:app
    method: GET
    func: get_artifact_content
    path: /artifact/{id}/content
    
  # wippy.session.api:get_session
  - name: get_session
    kind: function.lua
    meta:
      comment: Get detailed session info
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    source: file://get_session.lua
    modules:
      - http
      - security
    imports:
      message_repo: wippy.session.persist:message_repo
      session_repo: wippy.session.persist:session_repo
    method: handler
    pool:
      size: 2
    
  # wippy.session.api:get_session.endpoint
  - name: get_session.endpoint
    kind: http.endpoint
    meta:
      comment: Get session endpoint
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    method: GET
    func: get_session
    path: /sessions/get
    
  # wippy.session.api:list_sessions
  - name: list_sessions
    kind: function.lua
    meta:
      comment: List all user sessions
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    source: file://list_sessions.lua
    modules:
      - http
      - security
    imports:
      session_repo: wippy.session.persist:session_repo
    method: handler
    pool:
      size: 2
    
  # wippy.session.api:list_sessions.endpoint
  - name: list_sessions.endpoint
    kind: http.endpoint
    meta:
      comment: List sessions endpoint
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    method: GET
    func: list_sessions
    path: /sessions
    
  # wippy.session.api:session_messages
  - name: session_messages
    kind: function.lua
    meta:
      comment: Get messages for a session
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    source: file://session_messages.lua
    modules:
      - http
      - security
      - time
    imports:
      message_repo: wippy.session.persist:message_repo
      session_repo: wippy.session.persist:session_repo
    method: handler
    pool:
      size: 2
    
  # wippy.session.api:session_messages.endpoint
  - name: session_messages.endpoint
    kind: http.endpoint
    meta:
      comment: Session messages endpoint
      description: Session management HTTP endpoints
      depends_on:
        - app:api
        - ns:wippy.session
        - ns:wippy.session.persist
    method: GET
    func: session_messages
    path: /sessions/messages
    